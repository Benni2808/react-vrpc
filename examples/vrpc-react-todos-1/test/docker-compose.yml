version: '3.1'
services:
  cypress:
    image: cypress/included:6.1.0
    hostname: cypress
    depends_on:
      - frontend
    volumes:
      - ../frontend:/app
    working_dir: /app
    environment:
      - CYPRESS_baseUrl=http://frontend:3000
    command:
      - /app/cypress/wait-for
      - frontend:3000
      - --
      - cypress
      - run

  backend:
    image: node:12.20.0
    hostname: backend
    volumes:
      - ../backend:/app
    working_dir: /app
    command: ["node", "index.js"]

  frontend:
    image: node:12.20.0
    hostname: frontend
    volumes:
      - ../frontend:/app
    working_dir: /app
    expose:
      - 3000
    command: ["npm", "start"]
